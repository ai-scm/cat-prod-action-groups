{
  "openapi": "3.0.0",
  "info": {
    "title": "Contar Predios",
    "version": "1.0.0",
    "description": "API utilizada por el agente de Bedrock para consultar el número de predios asociados a un usuario, a través de la Lambda `cat-prod-lambda-contar-predios`."
  },
  "paths": {
    "/contar-predios": {
      "get": {
        "summary": "Obtiene el número de predios asociados a un usuario",
        "description": "Endpoint consumido por la Lambda `cat-prod-lambda-contar-predios` para obtener el número de predios asociados al usuario identificado por su documento.",
        "parameters": [
          {
            "in": "query",
            "name": "documento",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "Documento de identidad del usuario."
          }
        ],
        "responses": {
          "200": {
            "description": "Operación exitosa.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PrediosResponse"
                },
                "example": {
                  "numeroPredios": 3,
                  "mensaje": "Consulta exitosa",
                  "documento": "123456789"
                }
              }
            }
          },
          "400": {
            "description": "Parámetros inválidos o faltantes.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "message": "Missing required parameter 'documento'",
                  "code": "BAD_REQUEST"
                }
              }
            }
          },
          "401": {
            "description": "Token inválido, expirado, o sesión no autenticada.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "message": "Token inválido o expirado",
                  "code": "UNAUTHORIZED"
                }
              }
            }
          },
          "405": {
            "description": "Usuario no activo.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "message": "User is not active",
                  "code": "USER_INACTIVE"
                }
              }
            }
          },
          "406": {
            "description": "El usuario no tiene preguntas de seguridad registradas.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "message": "User has no security questions",
                  "code": "NO_SECURITY_QUESTIONS"
                }
              }
            }
          },
          "500": {
            "description": "Error interno del backend o error no controlado.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "message": "Internal server error",
                  "code": "INTERNAL_ERROR"
                }
              }
            }
          },
          "502": {
            "description": "Error de red, timeout o fallo al conectar con el sistema externo.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "message": "Timeout connecting to external API",
                  "code": "API_TIMEOUT"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "PrediosResponse": {
        "type": "object",
        "properties": {
          "numeroPredios": {
            "type": "integer",
            "description": "Número total de predios asociados al usuario."
          },
          "mensaje": {
            "type": "string"
          },
          "documento": {
            "type": "string"
          }
        },
        "required": [
          "numeroPredios",
          "mensaje",
          "documento"
        ]
      },
      "ErrorResponse": {
        "type": "object",
        "properties": {
          "message": {
            "type": "string"
          },
          "code": {
            "type": "string"
          }
        },
        "required": [
          "message",
          "code"
        ]
      }
    }
  }
}
